<link rel="import" href="../polymer/polymer.html"> 
<link rel="import" href="../th-theme/th-theme.html"> 
<link rel="import" href="../lens-data-table/lens-data-table.html">
<link rel="import" href="../lens-u-options-editor/lens-u-options-editor.html">

<polymer-element name="lens-node" attributes="input output componentList type finalResult components">
  <template>
    <core-style ref="theme"></core-style>
    <link rel="stylesheet" href="lens-node.css">

    <!-------------------------------- INPUT NODE START -------------------------------->
    <template if="{{type==='input'}}">
      
        <h3><template if="{{components.length}}"> {{components[0].friendly}}</template></h3>
      
      <div class="table-container">
        <lens-data-table id="inputTable" minRows="20" minCols="7" output="{{data}}"></lens-data-table>
      </div>
      <div class="component-container">
        <content></content>
      </div>      

    </template>
    <!--------------------------------  INPUT NODE END  -------------------------------->

  
    <!-------------------------------- TRANSFORM NODE START -------------------------------->
    <template if="{{type==='transform'}}">
      <!-- data table  w/input output switch -->
      <!-- container for component -->

    </template>
    <!--------------------------------  TRANSFORM NODE END  -------------------------------->

  
    <!-------------------------------- VISUAL NODE START -------------------------------->
    <template if="{{type==='visualize'}}">
      <!-- data table -->
      <!-- container for components -->
    </template>
    <!--------------------------------  VISUAL NODE END  -------------------------------->
  
  </template>
  <script>
    Polymer({
      components:[],
      /**
       * 'addElement' callback to when an element is clicked on; element is imported, initialized and appended to the DOM
       * @param {[type]} 'selection' is the element clicked 
       */
      addElement: function(e, detail, selection){
        var self = this,
            name = selection.className,
            directory = "../" + name + "/" + name + ".html",
            pathToEl = this.resolvePath(directory); // construct path to component

        
        // Dynamically create HTML import for component
        Polymer.import([pathToEl], function(){ // TODO: this path is different in the lenscomposer app -- doesnt point to bower_components directory
          var newEl = document.createElement(name);
          // if (self.type !=="input"){ // if the component is visual, set the input to the data selector output if avail, otherwise the table data
          //   self.component.style.height = "100%";
          //   self.component.style.width = "100%";
          //   self.component.input = self.cloneArray(self.selectedData) || self.cloneArray(self.data);
          // } 
            // if (self.component){
          // self.component.animateOnInit = true;
          // self.component.style.width = "100%";
          // self.getFieldsFromComponent();
          // self.component.input = self.cloneArray(self.selectedData) || self.cloneArray(self.data);
        // }

          self.appendChild(newEl);
          self.components.push({name: name, friendly: selection.label ,tag: newEl})
          // self.componentName = selection.label
          // self.setComponentObserver(); // observe changes to output of component
        })
        
      },
    });
  </script>
</polymer-element>